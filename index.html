<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LA MAYORISTA EXPRESS</title>

<!-- PWA -->
<link rel="manifest" href="data:application/manifest+json,{
  &quot;name&quot;:&quot;LA MAYORISTA EXPRESS&quot;,
  &quot;short_name&quot;:&quot;MAYORISTA&quot;,
  &quot;start_url&quot;:&quot;.&quot;,
  &quot;display&quot;:&quot;standalone&quot;,
  &quot;background_color&quot;:&quot;#ffffff&quot;,
  &quot;theme_color&quot;:&quot;#ff4d00&quot;
}">
<meta name="theme-color" content="#ff4d00">

<style>
:root{
  --primary:#ff4d00;
  --bg:#f6f6f6;
  --card:#ffffff;
  --text:#222;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--bg);
  color:var(--text);
}
header{
  position:fixed;
  top:0;left:0;right:0;
  background:#fff;
  z-index:1000;
  padding:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}
header h1{
  margin:0;
  font-size:18px;
  font-weight:900;
  color:var(--primary);
}
.top{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.top input,.top select{
  flex:1;
  padding:8px 10px;
  border-radius:16px;
  border:1px solid #ccc;
  font-size:13px;
}
#cartBtn{
  background:var(--primary);
  color:#fff;
  border:none;
  border-radius:16px;
  padding:8px 12px;
  font-weight:900;
  display:flex;
  align-items:center;
  gap:6px;
}
#cartTotal{
  font-size:12px;
}
.notice{
  margin-top:86px;
  font-size:12px;
  text-align:center;
  background:#111;
  color:#fff;
  padding:6px;
}
.products{
  padding:10px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
}
.product{
  background:var(--card);
  border-radius:14px;
  padding:10px;
  text-align:center;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}
.emoji{
  font-size:42px;
}
.product h3{
  font-size:13px;
  margin:6px 0 2px;
}
.product p{
  font-size:12px;
  margin:2px 0;
}
.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:10px;
  margin-top:6px;
}
.controls button{
  width:28px;
  height:28px;
  border-radius:50%;
  border:none;
  background:var(--primary);
  color:#fff;
  font-size:16px;
  font-weight:900;
}
.qty{
  min-width:20px;
  text-align:center;
  font-weight:900;
}
#cart{
  position:fixed;
  top:0;
  left:-100%;
  width:100%;
  max-width:420px;
  height:100%;
  background:#fff;
  z-index:3000;
  transition:.3s;
  padding:12px;
  overflow-y:auto;
}
#cart.show{left:0}
.cart-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.cart-header h2{
  margin:0;
  font-size:18px;
}
.cart-item{
  display:flex;
  justify-content:space-between;
  font-size:13px;
  margin:4px 0;
}
.cart-item button{
  border:none;
  background:none;
  color:red;
  font-size:14px;
}
.total{
  font-size:16px;
  font-weight:900;
  margin:10px 0;
}
.cart select,.cart input{
  width:100%;
  padding:8px;
  border-radius:12px;
  border:1px solid #ccc;
  margin:4px 0;
}
.btn{
  width:100%;
  padding:10px;
  border:none;
  border-radius:12px;
  font-weight:900;
  margin-top:6px;
}
.btn-primary{background:var(--primary);color:#fff}
.btn-dark{background:#111;color:#fff}
.invoice{
  background:#f2f2f2;
  padding:8px;
  border-radius:10px;
  font-size:12px;
  margin-top:6px;
  display:none;
}
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#111;
  color:#fff;
  padding:10px 16px;
  border-radius:20px;
  display:none;
  z-index:4000;
}
</style>
</head>

<body>

<header>
  <h1>LA MAYORISTA EXPRESS</h1>
  <div class="top">
    <input id="search" placeholder="Buscar producto">
    <select id="currency">
      <option value="CUP">CUP</option>
      <option value="USD">USD</option>
      <option value="MLC">MLC</option>
      <option value="CLASICA">Tarjeta Cl√°sica</option>
      <option value="CRYPTO">Criptomoneda</option>
    </select>
    <button id="cartBtn">üõí <span id="cartTotal">0 CUP</span></button>
  </div>
</header>

<div class="notice">Precios mayoristas ¬∑ Cuba ¬∑ Rebaja 30%</div>

<div class="products" id="products"></div>

<div id="cart">
  <div class="cart-header">
    <h2>Carrito</h2>
    <button onclick="toggleCart()">‚ùå</button>
  </div>

  <h3>Datos del cliente</h3>
  <input id="name" placeholder="Nombre">
  <input id="phone" placeholder="Tel√©fono">

  <select id="payment">
    <option>Efectivo</option>
    <option>Transferencia</option>
    <option>Criptomoneda</option>
  </select>

  <select id="delivery">
    <option value="0">Recoger en tienda</option>
    <option value="1500">Mensajer√≠a (+1500 CUP)</option>
  </select>

  <div id="cartItems"></div>
  <div class="total" id="total"></div>

  <button class="btn btn-dark" onclick="clearCart()">Vaciar carrito</button>
  <button class="btn btn-primary" onclick="toggleInvoice()">Ver factura</button>
  <button class="btn btn-primary" onclick="sendWhatsApp()">Enviar por WhatsApp</button>

  <div class="invoice" id="invoice"></div>
</div>

<div class="toast" id="toast"></div>

<script>
const rates={CUP:1,USD:495,MLC:410,CLASICA:410,CRYPTO:500};

const productsData=[
["üçö","Arroz 50kg",8500,"1 saco"],
["üç¨","Az√∫car 50kg",7800,"1 saco"],
["üõ¢Ô∏è","Aceite 1L x12",9200,"1 caja"],
["ü•õ","Leche en polvo",13500,"1 saco"],
["üçó","Pollo 10kg",16000,"1 caja"],
["ü•ö","Huevos 30u",4200,"1 caja"],
["üßÇ","Sal 25kg",2800,"1 saco"],
["üçù","Pasta 20kg",7200,"1 caja"],
["üçû","Harina 25kg",6400,"1 saco"],
["üßº","Detergente",9800,"1 saco"],
["üßª","Papel higi√©nico",5400,"1 caja"],
["ü™£","Cloro",3600,"1 caja"],
["üßΩ","Jab√≥n lavar",4900,"1 caja"],
["üß¥","Shampoo",8600,"1 caja"],
["ü™•","Pasta dental",5100,"1 caja"],
["ü•§","Refresco",5400,"1 caja"],
["‚òï","Caf√©",18500,"1 saco"],
["üç™","Galletas",6100,"1 caja"],
["üç´","Chocolate",9800,"1 caja"],
["ü•´","Conservas",8800,"1 caja"],
["üßÉ","Jugos",5700,"1 caja"],
["üçØ","Miel",9200,"1 caja"],
["üßà","Mantequilla",11200,"1 caja"],
["üçö","Arroz partido",6900,"1 saco"],
["üç¨","Az√∫car prieta",7500,"1 saco"],
["üßº","Jab√≥n tocador",4300,"1 caja"],
["üß¥","Suavizante",8200,"1 caja"],
["üßÇ","Condimentos",6100,"1 caja"],
["üçó","Salchichas",9400,"1 caja"],
["ü•ì","Picadillo",8900,"1 caja"]
];

let cart=JSON.parse(localStorage.getItem("cart"))||{};

function render(){
  products.innerHTML="";
  const q=search.value.toLowerCase();
  const cur=currency.value;
  productsData.filter(p=>p[1].toLowerCase().includes(q)).forEach(p=>{
    const qty=cart[p[1]]?.qty||0;
    products.innerHTML+=`
      <div class="product">
        <div class="emoji">${p[0]}</div>
        <h3>${p[1]}</h3>
        <p>M√≠n: ${p[3]}</p>
        <p><b>${(p[2]/rates[cur]).toFixed(2)} ${cur}</b></p>
        <div class="controls">
          <button onclick="change('${p[1]}',${p[2]},-1)">‚àí</button>
          <div class="qty">${qty}</div>
          <button onclick="change('${p[1]}',${p[2]},1)">+</button>
        </div>
      </div>`;
  });
  updateCart();
}

function change(name,price,delta){
  if(!cart[name])cart[name]={price,qty:0};
  cart[name].qty+=delta;
  if(cart[name].qty<=0)delete cart[name];
  localStorage.setItem("cart",JSON.stringify(cart));
  toast("Carrito actualizado");
  render();
}

function updateCart(){
  let sum=0,html="";
  const cur=currency.value;
  for(let k in cart){
    sum+=cart[k].price*cart[k].qty;
    html+=`<div class="cart-item">${k} x${cart[k].qty}<button onclick="removeItem('${k}')">‚úñ</button></div>`;
  }
  sum+=Number(delivery.value||0);
  total.innerText=`Total: ${(sum/rates[cur]).toFixed(2)} ${cur}`;
  cartTotal.innerText=total.innerText.replace("Total: ","");
  cartItems.innerHTML=html||"Carrito vac√≠o";
  invoice.innerText=cartItems.innerText+"\n"+total.innerText;
}

function removeItem(k){
  delete cart[k];
  localStorage.setItem("cart",JSON.stringify(cart));
  render();
}

function clearCart(){
  cart={};
  localStorage.removeItem("cart");
  render();
}

function toggleCart(){cartDiv.classList.toggle("show")}
const cartDiv=document.getElementById("cart");

function toggleInvoice(){
  invoice.style.display=invoice.style.display==="none"?"block":"none";
}

function sendWhatsApp(){
  if(!name.value||!phone.value){toast("Completa tus datos");return;}
  let msg=`PEDIDO LA MAYORISTA EXPRESS\nCliente: ${name.value}\nTel: ${phone.value}\nPago: ${payment.value}\nEntrega: ${delivery.options[delivery.selectedIndex].text}\n\n`;
  for(let k in cart){msg+=`${k} x${cart[k].qty}\n`}
  msg+=`\n${total.innerText}`;
  window.open("https://wa.me/5353420021?text="+encodeURIComponent(msg));
}

function toast(t){
  const x=document.getElementById("toast");
  x.innerText=t;
  x.style.display="block";
  setTimeout(()=>x.style.display="none",1000);
}

search.oninput=render;
currency.onchange=render;
delivery.onchange=render;
cartBtn.onclick=toggleCart;

render();

// Service Worker inline
if('serviceWorker'in navigator){
  const swBlob=new Blob([`
    self.addEventListener('install',e=>self.skipWaiting());
    self.addEventListener('fetch',e=>{});
  `],{type:'text/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(swBlob));
}
</script>

</body>
  </html>
